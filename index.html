<!DOCTYPE html>
<html>
<head>
    <title>CanaryTrap Alert Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title">üê¶ CanaryTrap Alert Dashboard</h1>
            <table class="table is-fullwidth is-striped">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Token</th>
                        <th>IP Address</th>
                        <th>User Agent</th>
                    </tr>
                </thead>
                <tbody id="alertsTableBody">
                    <tr><td colspan="4">No alerts yet. Traps have not been triggered.</td></tr>
                </tbody>
            </table>
        </div>
    </section>
    <script>
        async function loadAlerts() {
            try {
                // Fetch the alerts.json file directly from GitHub
                const response = await fetch('https://raw.githubusercontent.com/carry100/canarytrap-dashboard/main/alerts.json');
                const alerts = await response.json();
                const tableBody = document.getElementById('alertsTableBody');
                
                if (alerts.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="4">No alerts yet. Traps have not been triggered.</td></tr>';
                    return;
                }

                tableBody.innerHTML = ''; // Clear the message
                alerts.reverse().forEach(alert => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(alert.timestamp).toLocaleString()}</td>
                        <td><code>${alert.token}</code></td>
                        <td>${alert.sourceIP}</td>
                        <td>${alert.userAgent.substring(0, 60)}...</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading alerts:", error);
                document.getElementById('alertsTableBody').innerHTML = '<tr><td colspan="4">Error loading alerts.</td></tr>';
            }
        }
        // Load alerts when the page opens
        loadAlerts();
    </script>
</body>
</html>
