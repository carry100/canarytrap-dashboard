// Use GitHub Pages URL instead - this should work with CORS
const API_URL = 'https://carry100.github.io/canarytrap-dashboard/alerts.json';

async function loadAlerts() {
    try {
        console.log('Loading data from GitHub Pages...');
        
        const response = await fetch(API_URL, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
        }

        const data = await response.json();
        console.log('Data loaded successfully:', data);
        displayAlerts(data);
        hideLoadingMessage();

    } catch (error) {
        console.error('Error:', error);
        showError(`Failed to load: ${error.message}`);
        hideLoadingMessage();
        
        // Fallback to Solution 1 if this fails
        console.log('Trying GitHub API as fallback...');
        loadAlertsWithGitHubAPI();
    }
}

// Fallback function using GitHub API
async function loadAlertsWithGitHubAPI() {
    const githubApiUrl = 'https://api.github.com/repos/carry100/canarytrap-dashboard/contents/alerts.json';
    
    try {
        const response = await fetch(githubApiUrl, {
            headers: {
                'Accept': 'application/vnd.github.v3+json'
            }
        });

        if (response.ok) {
            const data = await response.json();
            if (data.content && data.encoding === 'base64') {
                const decodedContent = atob(data.content);
                const alertsData = JSON.parse(decodedContent);
                displayAlerts(alertsData);
            }
        }
    } catch (fallbackError) {
        console.error('Fallback also failed:', fallbackError);
    }
}
